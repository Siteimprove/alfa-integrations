# Reporting on results

See [how to audit a page](../auditing/basic.md) for getting the audit results in the first place.

This page shows basic usage of the reporting utilities, see [common configuration](./configuration.md) for frequent set up such as customizing test name; and [advanced configuration](./advanced.md) for more complex setups.

## Uploading results to the Siteimprove Intelligence Platform

Users of the Siteimprove Intelligence Platform can upload audit results and view them in the Page Report. You first need to [create an API key](https://my2.siteimprove.com/Integrations/Api/ManageApiKeys) in the Siteimprove Intelligence Platform.

Then, simply use the `SIP.upload` function on the audit result, providing the Siteimprove Intelligence Platform credentials. Here, the credentials are passed as environment variables. Depending on setup it might be more convenient to use CI/CD secrets, … It is not advised to hard-code the credentials in the code as these should be treated as any password.

```typescript
import { SIP } from "@siteimprove/alfa-test-utils";

const pageReportURL = await SIP.upload(alfaResult, {
  userName: process.env.SI_USER_NAME!, // email address of the user.
  apiKey: process.env.SI_API_KEY!, // API key generated in the platform.
});
```

This returns a URL to a Siteimprove Intelligence Platform page report showing the audit results, embedded within a [`Result` object](https://github.com/Siteimprove/alfa/blob/main/docs/api/alfa-result.md) to handle errors, use `console.log(pageReportURL.getOrElse(() => pageReportURL.getErrUnsafe()));` to show its value.

> **Note:** Siteimprove recommends that you include some basic information about the latest commit together with the upload, at least the branch name. This opens possibilities of grouping and reporting based on it, e.g. to follow the number of issues in a given branch. See [common configuration](./configuration.md#including-commit-information) for more information.

## Pretty printing results in the console

Use the `Logging.fromAudit(alfaResult).print()` function to pretty print results. If a Page Report URL was generated by the [upload](#uploading-results-to-the-siteimprove-intelligence-platform) step, it can be passed to it in order to provide direct links to each of the issues.

```typescript
import { Logging } from "@siteimprove/alfa-test-utils";

// Log results, with links to individual issues in the Page Report.
Logging.fromAudit(alfaResult, pageReportURL).print();

// Simply log an overview of the results and number of issues per rule.
Logging.fromAudit(alfaResult).print();
```

## Cypress

When using Cypress, reporting must occur in the NodeJS word, not in the Cypress world (otherwise, it has no access to console logging, …)

This means that the audit must first be serialised, then sent to the NodeJS world through a `cy.task` call.

```typescript
// cypress.config.ts file

import type { Audit } from "@siteimprove/alfa-test-utils/audit";
import { Logging, SIP } from "@siteimprove/alfa-test-utils/report";

export default defineConfig({
  // other config options
  e2e: {
    setupNodeEvents(on, config) {
      // implement node event listeners here
      on("task", {
        async report(audit: Audit.JSON): Promise<null> {
          const pageReportUrl = await SIP.upload(audit, {
            userName: process.env.SI_USER_EMAIL,
            apiKey: process.env.SI_API_KEY,
          });

          Logging.fromAudit(audit, pageReportUrl).print();

          return null;
        },
      });
    },
  },
});
```

And from Cypress:

```typescript
// test-file.spec.ts

cy.document()
  .then(AlfaCypress.toPage)
  .then(Audit.run)
  .then(async (alfaResult) => cy.task("report", alfaResult.toJSON()));
```
